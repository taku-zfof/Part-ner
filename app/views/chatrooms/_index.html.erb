<!--タイトルとタブメニュー-->
<div class = "row mt-lg-5 mt-3 mb-3">
  <h3 class="col-12 col-lg-6"><strong>メッセージ一覧</strong></h3>
  <ul class="nav nav-tabs nav-justified col-12 col-lg-6">
    <li class="nav-item">
      <a
        class="nav-link active"
        id="show_button"
        data-mdb-toggle="tab"
        href="#show_chatrooms_index"
        aria-selected="true"
        ><strong>表示</strong></a
      >
    </li>
    <li class="nav-item" role="presentation">
      <a
        class="nav-link"
        id="hide_button"
        data-mdb-toggle="tab"
        href="#hide_chatrooms_index"
        aria-selected="false"
        ><strong>非表示</strong></a
      >
    </li>
  </ul>
</div>

<div class="chatrooms_indexes">
  
  <div class="tab-pane fade show active" id="show_chatrooms_index">
    <% show_chatrooms.each do |chatroom| %>
      <%= link_to chatroom_path(chatroom) ,data: {"turbolinks" => false} do %> <!--turbolinksを切らないとactioncableが発火しないため-->
    
        <div class="card index_card mb-4 py-3 text-body bg-light">
          <div class="row">
    
            <!--画像2カラム-->
            <div class="col-2 m-auto d-flex justify-content-end">
              <% if chatroom.user == current_user %>
                <%= image_tag chatroom.job.user.get_image(100,100), class: 'rounded-circle mt-2 img-thumbnail img-fluid'%>
              <% else %>
                <%= image_tag chatroom.user.get_image(100,100), class: 'rounded-circle mt-2 img-thumbnail img-fluid'%>
              <% end %>
            </div>
    
            <!--タイトルと本文７カラム-->
            <div class="col-7 d-flex flex-column justify-content-center">
              <h4><strong><% if chatroom.user == current_user %>
                    <%= chatroom.job.user.name %>
                  <% else %>
                    <%= chatroom.user.name %>
                  <% end %>
                 （<%= chatroom.job.tytle %>）
              </strong></h4>
              <!--そのチャットルームの最新のメッセージを表示する。５０文字まで-->
              <p class="text-break"><% if Message.where(chatroom_id: chatroom.id).exists? %>
                 <%= Message.where(chatroom_id: chatroom.id).last.content.truncate(50) %>
                 <% end %></p>
            </div>
    
            <!--未読バッジ３カラム 未読ある時のみ表示-->
            <div class="col-3 d-flex align-items-center justify-content-evenly">
              <% if chatroom.unread_messages(current_user).exists? %>
                <h3><span class="badge badge-danger rounded-pill">
                  <%= chatroom.unread_messages(current_user).count %>
                </span></h3>
              <% end %>
            </div>
            
          </div>
        </div>
    
      <% end%>
    <% end %>
  </div>
  
  <div class="tab-pane fade" id="hide_chatrooms_index">
    <% hide_chatrooms.each do |chatroom| %>
      <%= link_to chatroom_path(chatroom) ,data: {"turbolinks" => false} do %> <!--turbolinksを切らないとactioncableが発火しないため-->
    
        <div class="card index_card mb-4 py-3 text-body bg-light">
          <div class="row">
    
            <!--画像2カラム-->
            <div class="col-2 m-auto d-flex justify-content-end">
              <% if chatroom.user == current_user %>
                <%= image_tag chatroom.job.user.get_image(100,100), class: 'rounded-circle mt-2 img-thumbnail img-fluid'%>
              <% else %>
                <%= image_tag chatroom.user.get_image(100,100), class: 'rounded-circle mt-2 img-thumbnail img-fluid'%>
              <% end %>
            </div>
    
            <!--タイトルと本文７カラム-->
            <div class="col-7 d-flex flex-column justify-content-center">
              <h4><strong><% if chatroom.user == current_user %>
                    <%= chatroom.job.user.name %>
                  <% else %>
                    <%= chatroom.user.name %>
                  <% end %>
                 （<%= chatroom.job.tytle %>）
              </strong></h4>
              <!--そのチャットルームの最新のメッセージを表示する。５０文字まで-->
              <p class="text-break"><% if Message.where(chatroom_id: chatroom.id).exists? %>
                 <%= Message.where(chatroom_id: chatroom.id).last.content.truncate(100) %>
                 <% end %></p>
            </div>
    
            <!--未読バッジ３カラム 未読ある時のみ表示-->
            <div class="col-3 d-flex align-items-center justify-content-evenly">
              <% if chatroom.unread_messages(current_user).exists? %>
                <h3><span class="badge badge-danger rounded-pill">
                  <%= chatroom.unread_messages(current_user).count %>
                </span></h3>
              <% end %>
            </div>
            
          </div>
        </div>
    
      <% end%>
    <% end %>
  </div>
  
</div>

<!--タブ切り替え時にもう片方の中身を非表示、再表示するスクリプト-->
<script>
$(function() {
  $('#show_button').on('click',function(event){
    $('#hide_chatrooms_index').addClass("d-none");
    $('#show_chatrooms_index').removeClass("d-none");
  });
  $('#hide_button').on('click',function(event){
    $('#show_chatrooms_index').addClass("d-none");
    $('#hide_chatrooms_index').removeClass("d-none");
  });
});
</script>
